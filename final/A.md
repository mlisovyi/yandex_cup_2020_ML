
# A. Обучение на ограниченной выборке

Constraint | Value
|---|---|
Ограничение времени |	40 секунд
Ограничение памяти |	64Gb
Ввод |	стандартный ввод
Вывод |	стандартный вывод

- [A. Обучение на ограниченной выборке](#a-обучение-на-ограниченной-выборке)
  - [Формат ввода](#формат-ввода)
  - [Примечания](#примечания)


В Поиске Яндекса ежедневно задаются десятки миллионов новых запросов. Зачастую возникают задачи их классификации по различным темам (к примеру, для создания новых элементов-колдунщиков). При этом ресурс для создания обучающей выборки может быть ограниченным: например, асессоры смогут разметить для задачи только ограниченное число запросов. Поэтому в таких задачах важно правильно собирать выборку для разметки. Если тематика запроса узкая, то размечать весь поток необязательно.

В наборе данных каждого объекта (поискового запроса) известны его признаки: C категориальных и F вещественных. Рассматриваются T тематик. Каждый объект может относиться к любому подмножеству этого набора тематик (в том числе к пустому). Набор данных разделен случайным образом на обучающий и тестовый.

Ваша задача — получить данные для обучения и обучить на них модель принадлежности запросов к этим тематикам. Вы можете запросить размеченные данные двумя способами: 1) запросить случайную подвыборку всего обучающего множества объектов или 2) запросить случайную подвыборку объектов с заданным значением какого-то категориального признака.

В каждом случае вам нужно указать необходимое число объектов (b). Объекты возвращаются без повторения. Если в ответе оказалось менее b объектов, объекты с таким ограничением в обучающей выборке закончились, запрашивать их больше нет смысла.

Всего вы можете запросить не более B объектов. После этого вам выдаются D объектов из тестового множества, разметка тематик которых скрыта от вас. Для каждой из тематик вы должны указать те запросы, которые относятся к ней, согласно вашим предсказаниям. Качество вашего решения будет оцениваться по среднему арифметическому метрики F1 каждой тематики.

Ограничения:

* T = 3.

* C = 4.

* F = 40.

* B = 10000.

* D = 1000000 (кроме тестового набора, см. Примечания).

## Формат ввода

Внимание! Эта задача в интерактивном формате.

В первой строке входа через пробел указаны целые числа T, C и F.

Во второй строке через пробел указано C целых чисел Ci — ограничения на значения каждого категориального признака.

В третьей строке указано одно целое число B — ваш изначальный бюджет на разметку.

Затем нужно вывести на отдельных строках один или несколько запросов одного из следующих трех типов.

1) Запрос "req 0 0 b" — запрос b размеченных объектов без ограничения, где b — положительное целое число, не превышающее ваш текущий бюджет. В следующей строке входа будет записано целое число s (0 ≤ s ≤ b). В следующих s строках будут выписаны объекты с разметкой. Каждый объект описывается строкой из чисел через пробел: сначала T чисел 0 или 1, означающих, относится ли данный объект к соответствующим тематикам, затем C целых чисел ci (0 ≤ ci < Ci) — значения категориальных признаков, затем F вещественных чисел — значений вещественных признаков. Из вашего бюджета вычтется s.

2) Запрос "req k v b" (1 ≤ k ≤ C, 0 ≤ v < Ck, b — положительное целое число, не превышающее число, не превышающее ваш текущий бюджет) — запрос b размеченных объектов, у которых категориальный признак k равен v. Ответ на этот запрос имеет такой же формат, как и в предыдущем случае.

3) Запрос "test" — запрос на начало применения модели. Этот запрос должен быть всегда один и всегда последний. В следующей строке входа будет записано целое число D. В следующих D строках будут выписаны объекты без разметки. В строке i (0 ≤ i < D) будет описан объект с номером i строкой из чисел через пробел: C целых чисел cj (0 ≤ cj < Cj) — значения категориальных признаков, затем F вещественных чисел — значений вещественных признаков.

Затем нужно выписать строку из T целых чисел через пробел: для каждой тематики — количество ti (0 < ti ≤ D) объектов, отнесенных к ней вашей моделью. Затем для каждой тематики i нужно выписать на отдельных строках ti индексов объектов (от 0 до D - 1), отнесенных к ней. В рамках одной тематики индексы объектов не должны повторяться.

## Примечания

В тестирующей системе используются два набора данных: public и private. Данные в них получены из одного и того же распределения. В течение тура для оценки метрики и расчёта баллов будет использоваться набор public. По окончанию тура все финальные решения участников запустятся на наборе private, и расчёт баллов будет выполнен по оценке метрики на этом наборе.

Для удобства вы можете использовать тестовый набор данных и инструменты для тестирования, которые можно скачать по ссылке https://yadi.sk/d/DRK0oq_F7VKowg. Описание файлов:

01 — тестовый набор данных;

01.a — скрытые таргеты для тестовой выборки;

testing_tool.py — утилита для тестирования решения локально;

interact.py — аналог интерактора контеста, используется в testing_tool.py;

checker.py — скрипт для оценки финального скора;

solution.py — пример решения на Python;

solution.cpp — пример решения на C++.

Данные в тренировочном наборе получены из другого распределения и имеют другие ограничения: D = 100000.
